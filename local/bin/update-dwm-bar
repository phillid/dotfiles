#!/bin/bash

DELAY=20
sep=$(echo -e '\u2502')

while true; do
	if hash upsc 2>/dev/null; then
		ups="UPS: $(upsc eaton5e@zoidberg battery.charge)% $sep "
	fi
	currency=
	if [ ! -z "$(ls -A ~/.cache/currency/)" ] ; then
		for c in ~/.cache/currency/* ; do
			currency="$currency$(cat $c) "
		done
		currency="$currency$sep "
	fi
	if [ -d "/sys/class/power_supply/BAT0/" ]; then
		bat="$(cat /sys/class/power_supply/BAT0/capacity)%"
		case "$(cat /sys/class/power_supply/BAT0/status)" in
			Full)
				bat_icon='âœ“'
				;;
			Charging)
				bat_icon='â–²'
				;;
			Discharging)
				bat_icon='â–¼'
				;;
			*)
				bat_icon="(?)"
				;;
		esac
		bat_string="$bat_icon $bat $sep "
	fi
	thermal_string="ðŸŒ¡"
	for zone in /sys/class/thermal/thermal_zone* ; do
		temp="$(cat $zone/temp)"
		thermal_string="$thermal_string $(($temp / 1000)),"
	done
	thermal_string="${thermal_string%,} Â°C"
	datetime_string=$(date "+%A $sep %d %h %Y $sep %_I:%M %p (UTC%:::z)")
	xsetroot -name "$currency$ups$thermal_string $sep $bat_string$datetime_string" || exit
	sleep "$DELAY"
done

